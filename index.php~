<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title></title>
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,700">
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.css" />
	<link rel="stylesheet" href="css/jquery.ui.datepicker.mobile.css" />
	<link rel="stylesheet" href="css/style.css" />
	<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
	<script>
		//reset type=date inputs to text
		$( document ).bind( "mobileinit", function(){
			$.mobile.page.prototype.options.degradeInputs.date = true;
		});	
$(document).on("mobileinit", function () {
	$.mobile.ajaxEnabled = false;
    $.mobile.pushStateEnabled = false;
});		
	</script>
	<script src="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.js"></script>
	<script src="js/jQuery.ui.datepicker.js"></script>
	<script src="js/jquery.ui.datepicker.mobile.js"></script>
 <script>
  $(function() {
  
	function highlightDays() {
		$.ajax({
			url: "api.php",
			type: "POST",
			//dataType: 'json',
			success: function(data) {
				//data = JSON.parse(data);
				console.log(data);
			}
		});
	};
    $("#datepicker_view").datepicker({
    	dateFormat: 'yy-mm-dd',
    	beforeShowDay: highlightDays(),
    	onSelect: function(date) {
    		// put selected date into object
    		var data = {'date': date, 'action': 'view'};
			$('input[name="date"]').val(date);    		
    		$.ajax({
    			url: "api.php",
    			data: data,
				dataType: 'json',
				success: function(data) {
					if (data == false) {
						$("#view_date_output").html('<table><tr><td>&nbsp;</td></tr><tr><td>No appointments on this date.</td></tr><tr><td>&nbsp;</td></tr></table>');
						$("#new_patients input[type='checkbox'], #follow_up_patients input[type='checkbox']").prop("checked", false);
						$(".ui-checkbox label").removeClass("ui-checkbox-on").attr("data-icon","checkbox-off").find(".ui-icon").removeClass("ui-icon-checkbox-on").addClass("ui-icon-checkbox-off");
					} else {
						$(".ui-checkbox label").removeClass("ui-checkbox-on").attr("data-icon","checkbox-off").find(".ui-icon").removeClass("ui-icon-checkbox-on").addClass("ui-icon-checkbox-off");
						console.log(data);
						for(var i=0;i<=data[1];i++) {
							// var total = data[1].split(",").length;
							if (i >= 1) {
								$("input#patient-" + i).prop("checked", true).next().attr("data-icon","checkbox-on").addClass("ui-checkbox-on").find(".ui-icon").addClass("ui-icon-checkbox-on").removeClass("ui-icon-checkbox-off");
							}
						}
						for(var i=0;i<=data[2];i++) {
							// var total = data[1].split(",").length;
							if (i >= 1) {
								$("input#follow-up-" + i).prop("checked", true).next().attr("data-icon","checkbox-on").addClass("ui-checkbox-on").find(".ui-icon").addClass("ui-icon-checkbox-on").removeClass("ui-icon-checkbox-off");
							}
						}
						if (data[1] > 6) {
							data_text_color = 'red';
						} else {
							data_text_color = 'green';
						}
						if (data[2] > 2) {
							text_color = 'red';
						} else {
							text_color = 'green';
						}						
						$("#view_date_output").html('<table><tr><td>Date: ' + data[3] + '</td>' + '</tr><tr><td class="' + data_text_color + '">Total new patient appts: ' + data[1] + '</td></tr><tr><td class="'+ text_color +'">Total Follow Ups: ' + data[2] + '</td></tr></table>' );
					}
				}
    		});	
    	}
  	});
	$("#form_submit").click(function() {
		current_date = $('input[name="date"]').val();

		//var new_patient_count = $("#new_patients input[type='checkbox']:checked").length;

		//var follow_up_count = $("#follow_up_patients input[type='checkbox']:checked").length;

		var submit_data = $("#patient_calendar").serialize();

		// var submit_data = {'date': current_date, 'checkboxes': 'checkboxes="'+ checkboxes +'"'};
		console.log(submit_data);
		$.ajax({
			url: "submit.php",
			type: "POST",
			data: submit_data,
			//dataType: 'json',
			success: function(submit_data) {
				$("#view_date_output").html("<p>Calendar updated</p>");
				return submit_data;
				//highlightFullDays();
			},
			error: function(xhr, status, text) {
				var response = $.parseJSON(xhr.responseText);

				console.log('Failure!');

				if (response) {
					console.log(response.error);
				} else {
					// This would mean an invalid response from the server - maybe the site went down or whatever...
				}
			}
		});
	});  	
  });	
  </script>
	<script id="source" language="javascript" type="text/javascript">
	$(function() {
		
		/*$("#datepicker_add").datepicker({
			dateFormat: 'yy-mm-dd',
			//beforeShowDay: highlightDays,
			onSelect: function(date) {
				// put selected date into object
				var data = {'date': date, 'action': 'add'};
		
				$.ajax({
					url: "api.php",
					data: data,
					dataType: 'json',
					success: function(data) {
						if (data == false) {
							//$("#date_output").html('<p>No appointments on this date.</p>');
						} else {
							for(var i=0;i<data.length;i++) {
								var total = data[1].split(",").length;

								$("#add_date_output").html('<p>Date: ' + data[2] + '</p>' + '<p>Total appts: ' + total + '</p>' );
						
							}
						}
					}
				});
		
			}
		});*/
	});

	 /* $(function () 
	  {
		//-----------------------------------------------------------------------
		// 2) Send a http request with AJAX http://api.jquery.com/jQuery.ajax/
		//-----------------------------------------------------------------------
		$.ajax({                                      
		  url: 'api.php',                  //the script to call to get data          
		  data: "",                        //you can insert url argumnets here to pass to api.php
		                                   //for example "id=5&parent=6"
		  dataType: 'json',                //data format      
		  success: function(data)          //on recieve of reply
		  {

		    var id = data[0];              //get id
		    var vname = data[1];           //get name
		    //--------------------------------------------------------------------
		    // 3) Update html content
		    //--------------------------------------------------------------------
		    $('#output').html("<b>id: </b>"+id+"<b> name: </b>"+vname); //Set output element html
		    //recommend reading up on jquery selectors they are awesome 
		    // http://api.jquery.com/category/selectors/
		  } 
		});
	  }); */

	  </script>  
	<style>
		body {
			font-family: 'Open Sans';
			font-size: 13px;
		}
		#wrap {
			width: 45em;
			margin: 0 auto;
		}
	</style>
</head>
<body>
	<div id="wrap">
		<div data-role="page" class="">	
			<div data-role="collapsible-set" data-theme="a" data-content-theme="d">
				<!--<div data-role="collapsible">
					<h3>Add patient to calendar</h3>
					<div id="datepicker_add"></div>
					<div id="add_date_output"></div>
					<fieldset data-role="controlgroup">
						<legend>Checkboxes, vertical controlgroup:</legend>
						<input type="checkbox" name="checkbox-1a" id="checkbox-1a" checked="">
						<label for="checkbox-1a">Cheetos</label>
						<input type="checkbox" name="checkbox-2a" id="checkbox-2a">
						<label for="checkbox-2a">Doritos</label>
						<input type="checkbox" name="checkbox-3a" id="checkbox-3a">
						<label for="checkbox-3a">Fritos</label>
						<input type="checkbox" name="checkbox-4a" id="checkbox-4a">
						<label for="checkbox-4a">Sun Chips</label>
					</fieldset>
					<div id="output"></div>	
				</div>-->
				<form action="submit.php" method="POST" id="patient_calendar">
				<div data-role="collapsible" data-collapsed="false">
					<h3>View Calendar</h3>
					<div class="pull-left">
					<div id="datepicker_view"></div>
					<input name="date" type="hidden" value="">
					</div>
					<div class="pull-left">					
					<div id="view_date_output" class="pull-left"></div>
					<!--<input type="submit" value="submit" data-role="button" data-inline="true" data-icon="check" data-theme="b">-->
					<p><a href="#" id="form_submit" data-role="button" data-inline="true" data-icon="check" data-theme="b">Update Calendar</a></p>
					</div>
					<div class="row">
						<div class="pull-left" id="new_patients">
							<fieldset data-role="controlgroup">
								<legend>New Patients:</legend>
								<?
									$i = 1;
									$numeric = array(
										'1'=>'One',
										'2'=>'Two',
										'3'=>'Three',
										'4'=>'Four',
										'5'=>'Five',
										'6'=>'Six',
										'7'=>'Seven',
										'8'=>'Eight',
										'9'=>'Nine',
										'10'=>'Ten',
										'11'=>'Eleven',
										'12'=>'Twelve',
										'13'=>'Thirteen',
										'14'=>'Fourteen',
										'15'=>'Fifteen',
										'16'=>'Sixteen',
										'17'=>'Seventeen',
										'18'=>'Eighteen',
										'19'=>'Nineteen',
										'20'=>'Twenty'
									);
									while ($i <= 20) {
										echo '<input type="checkbox" name="new_patient_values[]" id="patient-'.$i.'">';
										echo '<label for="patient-'.$i.'">'. $numeric[$i] .'</label>';
										$i++;
									}
								?>
								<!--<input type="checkbox" name="checkbox-1a" id="checkbox-1a" checked="">
								<label for="checkbox-1a">Cheetos</label>
								<input type="checkbox" name="checkbox-2a" id="checkbox-2a">
								<label for="checkbox-2a">Doritos</label>
								<input type="checkbox" name="checkbox-3a" id="checkbox-3a">
								<label for="checkbox-3a">Fritos</label>
								<input type="checkbox" name="checkbox-4a" id="checkbox-4a">
								<label for="checkbox-4a">Sun Chips</label>-->
							</fieldset>
						</div>		
						<div class="pull-left" id="follow_up_patients">
							<fieldset data-role="controlgroup">
								<legend>Follow Up Patients:</legend>
								<?
									$j = 1;
									while ($j <= 5) {
										echo '<input type="checkbox" name="follow_up_values[]" id="follow-up-'.$j.'">';
										echo '<label for="follow-up-'.$j.'">'. $numeric[$j] .'</label>';
										$j++;
									}
								?>
								<!--
								<input type="checkbox" name="checkbox-1a" id="checkbox-1a" checked="">
								<label for="checkbox-1a">Cheetos</label>
								<input type="checkbox" name="checkbox-2a" id="checkbox-2a">
								<label for="checkbox-2a">Doritos</label>
								<input type="checkbox" name="checkbox-3a" id="checkbox-3a">
								<label for="checkbox-3a">Fritos</label>
								<input type="checkbox" name="checkbox-4a" id="checkbox-4a">
								<label for="checkbox-4a">Sun Chips</label>-->
							</fieldset>
						</div>
					</div>
				</div>
				</form>
			</div>
		</div>
	</div>
</body>
</html>
